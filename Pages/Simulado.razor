@page "/simulado"
@inject IJSRuntime JS
@using info_app.Data
@inject QuestaoService service

<h1>Simulado</h1>
 @if (Questoes.Any())
                {
@foreach (var quest in Questoes)
{
    <div class="questao">
        <p>@quest.Id) @quest.QuestaoTitulo</p>
        <ul>
            <li><input id="Opcao1" type="radio" name="@quest.Id" class="rb" value="@quest.Opcao1" />@quest.Opcao1</li>
            <li><input id="Opcao2" type="radio" name="@quest.Id" class="rb" value="@quest.Opcao2" />@quest.Opcao2</li>
            <li><input id="Opcao3" type="radio" name="@quest.Id" class="rb" value="@quest.Opcao3" />@quest.Opcao3</li>
            <li><input id="Opcao4" type="radio" name="@quest.Id" class="rb" value="@quest.Opcao4" />@quest.Opcao4</li>
            <li><input id="Opcao5" type="radio" name="@quest.Id" class="rb" value="@quest.Opcao5" />@quest.Opcao5</li>
        </ul>
        <label name="@quest.Id" class="resposta" style="display:none;">@quest.Resposta</label>
    </div>
}

<button id="but1" type="button" class="btn-success" @onclick="DisplayResults">Submit</button>
<div id="lbluserres">@userResults</div>
}
else
{
    <tr><td colspan="6"><strong>Nenhuma questão disponível</strong></td></tr>
}
<style>
    .questao {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 20px;
    }

    ul {
        list-style-type: none;
        padding: 0;
    }

    li {
        margin-bottom: 5px;
    }

    .btn-success {
        margin-top: 20px;
    }
</style>

@code {
    List<Questao> Questoes = new List<Questao>();
    string userResults = "";

    protected override async Task OnInitializedAsync()
    {
        await AtualizaQuestoes();
    }

    private async Task AtualizaQuestoes()
    {
        Questoes = await service.RetornaQuestaoAsync();
    }

    private async Task DisplayResults()
    {
        userResults = "";

        foreach (var quest in Questoes)
        {
            var selectedOption = await JS.InvokeAsync<string>("eval", $"document.querySelector('input[name=\"{quest.Id}\"]:checked').value");
            var respostaCorreta = quest.Resposta;

            userResults += $"<p>Q {quest.Id}) ";

            if (selectedOption == respostaCorreta)
            {
                userResults += $"Sua resposta está correta: {selectedOption}</p>";
            }
            else
            {
                userResults += $"Sua resposta está incorreta. A resposta correta é: {respostaCorreta}</p>";
            }
        }
    }
}
